<html>

<head>
    <!-- include loader styles -->
    <link href="css/loader.css" rel="stylesheet" type="text/css">

    <!-- include our loader overlay script -->
    <script type="text/javascript" src="js/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- include chart script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-162446800-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'UA-162446800-1');
    </script>

    <meta charset="utf-8"/>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <!--
  ArcGIS API for JavaScript, https://js.arcgis.com
  For more information about the visualization-vv-color-animate sample, read the original sample description at developers.arcgis.com.
  https://developers.arcgis.com/javascript/latest/sample-code/visualization-vv-color-animate/index.html
  -->
    <title>WhereCOVID-19 App</title>

    <link rel="stylesheet" href="https://js.arcgis.com/4.15/esri/themes/dark-blue/main.css"/>
    <link rel="stylesheet" href="css/style.css"/>
    <script src="https://js.arcgis.com/4.15/"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/83341c3e60.js" crossorigin="anonymous"></script>

    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@700&display=swap" rel="stylesheet">
    <script src="js/ui.js"></script>

    <script>
        require([
            "esri/Map",
            "esri/layers/FeatureLayer",
            "esri/views/MapView",
            "esri/core/promiseUtils",
            "esri/widgets/Legend",
            "esri/widgets/Home",
            "esri/widgets/Slider",
            "esri/widgets/Fullscreen",
            "esri/geometry/SpatialReference",
            "esri/Basemap",
            "esri/layers/MapImageLayer",
            "esri/symbols/SimpleFillSymbol",
            "esri/layers/GroupLayer",
            "esri/widgets/LayerList",
            "esri/widgets/BasemapGallery",
            "esri/widgets/Expand",
            "esri/layers/GeoJSONLayer",
            "esri/tasks/support/Query",
            "esri/layers/support/LabelClass",
            "esri/widgets/Zoom",
            "dojo/dom",
            "dojo/date",
            "dojo/date/locale",
            "dojox/data/CsvStore",
            "dojo/request",
            "dojo/DeferredList",
            "dojo/Stateful",
            "dojo/_base/declare",
            "dojo/query",
            "dojo",
        ], function (
            Map,
            FeatureLayer,
            MapView,
            promiseUtils,
            Legend,
            Home,
            Slider,
            Fullscreen,
            SpatialReference,
            Basemap,
            MapImageLayer,
            SimpleFillSymbol,
            GroupLayer,
            LayerList,
            BasemapGallery,
            Expand,
            GeoJSONLayer,
            Query,
            LabelClass,
            Zoom,
            dom,
            date,
            locale,
            CsvStore,
            request,
            DeferredList,
            Stateful,
            declare,
            query,
            dojo,
        ) {

            // Subclass dojo/Stateful:
            const MyWatcher = declare([Stateful], {
                active_animation_layer: null,
                _active_animation_layerGetter: function () {
                    return this.active_animation_layer;
                },
                _active_animation_layerSetter: function (value) {
                    this.active_animation_layer = value;
                }
            });

            // Create an instance and initialize some property values:
            const mywatcher = new MyWatcher({
                active_animation_layer: null,
            });

            var production_mode = false; //true or false

            //global variables contain data
            var counties_data = null;
            var counties_data_str = null;
            var states_data = null;
            var states_data_str = null;
            var classes_data = null;
            var dynamic_classes_data = null;

            // main() is called after external json file is loaded
            function main(arg1) {

                //--------------------------------------------------------------------------
                //
                //  Setup UI
                //
                //--------------------------------------------------------------------------

                var applicationDiv = document.getElementById("applicationDiv");
                var sliderValue = document.getElementById("sliderValue");
                var playButton = document.getElementById("playButton");
                var titleDiv = document.getElementById("titleDiv");
                var animation = null;
                var slider = null;
                var sliderDiv = document.getElementById("sliderContainer");
                var myChart = document.getElementById('myChart').getContext('2d');

                // Query total numbers for left slide bar
                var confirmDiv = document.getElementById("total_confirm_div");
                var deathDiv = document.getElementById("total_death_div");
                var recoverDiv = document.getElementById("total_recover_div");

                //--------------------------------------------------------------------------
                //
                //  Setup Map and View
                //
                //--------------------------------------------------------------------------

                // var nyt_layer_states_url = "https://services.arcgis.com/GL0fWlNkwysZaKeV/arcgis/rest/services/nyt_states_data_dev/FeatureServer/0";
                // var nyt_layer_counties_url = "https://services.arcgis.com/GL0fWlNkwysZaKeV/arcgis/rest/services/nyt_counties_data_dev/FeatureServer/0";
                // var illinios_county_url = "https://services.arcgis.com/GL0fWlNkwysZaKeV/arcgis/rest/services/illinois_forecast_county_dev/FeatureServer/0";
                // var illinios_zipcode_url = "https://services.arcgis.com/GL0fWlNkwysZaKeV/arcgis/rest/services/illinois_forecast_zipcode_dev/FeatureServer/0";
                var nyt_layer_states_url = "preprocessing/nyt_states_data.geojson";
                var nyt_layer_counties_url = "preprocessing/nyt_counties_data.geojson";
                var illinios_county_url = "preprocessing/illinois/illinois_forecast_county.geojson";
                var illinios_zipcode_url = "preprocessing/illinois/illinois_forecast_zipcode.geojson";
                var illinois_hospitals_url = "preprocessing/illinois/illinois_hospitals.geojson";
                var illinois_testing_url = "preprocessing/illinois/illinois_testing.geojson";
                var illinois_report_url = "preprocessing/illinois/nyt_illinois_counties_data.geojson";

                if (production_mode) {
                    // nyt_layer_states_url = "https://services.arcgis.com/GL0fWlNkwysZaKeV/arcgis/rest/services/nyt_states_data/FeatureServer/0";
                    // nyt_layer_counties_url = "https://services.arcgis.com/GL0fWlNkwysZaKeV/arcgis/rest/services/nyt_counties_data/FeatureServer/0";
                    // illinios_county_url = "https://services.arcgis.com/GL0fWlNkwysZaKeV/arcgis/rest/services/illinois_forecast_county/FeatureServer/0";
                    // illinios_zipcode_url = "https://services.arcgis.com/GL0fWlNkwysZaKeV/arcgis/rest/services/illinois_forecast_zipcode/FeatureServer/0";
                    nyt_layer_states_url = "https://raw.githubusercontent.com/cybergis/cybergis.github.io/master/preprocessing/nyt_states_data.geojson";
                    nyt_layer_counties_url = "https://raw.githubusercontent.com/cybergis/cybergis.github.io/master/preprocessing/nyt_counties_data.geojson";
                    illinios_county_url = "https://raw.githubusercontent.com/cybergis/cybergis.github.io/master/preprocessing/illinois/illinois_forecast_county.geojson";
                    illinios_zipcode_url = "https://raw.githubusercontent.com/cybergis/cybergis.github.io/master/preprocessing/illinois/illinois_forecast_zipcode.geojson";
                    illinois_hospitals_url = "https://raw.githubusercontent.com/cybergis/cybergis.github.io/master/preprocessing/illinois/illinois_hospitals_valid.geojson";
                    illinois_testing_url = "https://raw.githubusercontent.com/cybergis/cybergis.github.io/master/preprocessing/illinois/illinois_testing.geojson";
                }

                const default_polygon_renderer = {
                    type: "simple",
                    symbol: {
                        type: "simple-fill",
                        color: [0, 0, 0, 0.1],
                        outline: { // autocasts as new SimpleLineSymbol()
                            color: [128, 128, 128, 0.5],
                        }
                    }
                };

                //nyt states
                //var nyt_layer_states = new FeatureLayer({
                var nyt_layer_states = new GeoJSONLayer({
                    url: nyt_layer_states_url,
                    outFields: ["*"],
                    title: "US States (New York Times)",
                    visible: false,
                    renderer: default_polygon_renderer,
                });

                //nyt counties
                //var nyt_layer_counties = new FeatureLayer({
                var nyt_layer_counties = new GeoJSONLayer({
                    url: nyt_layer_counties_url,
                    outFields: ["*"],
                    title: "US Counties (New York Times)",
                    visible: false,
                    renderer: default_polygon_renderer,
                });

                var illinois_counties = new GeoJSONLayer({
                    url: illinios_county_url,
                    outFields: ["*"],
                    title: "County-level Info",
                    renderer: illinoisZipCodeRender("CountyForecast", 7, 8200),
                    visible: false,
                });

                var illinois_zipcode = new GeoJSONLayer({
                        url: illinios_zipcode_url,
                        outFields: ["*"],
                        title: "Zipcode-level Info",
                        renderer: illinoisZipCodeRender("ZipCodeForecast", 0, 200),
                        visible: false,
                    }
                );

                var illinois_report = new GeoJSONLayer({
                    url: illinois_report_url,
                    outFields: ["*"],
                    title: "Cases (New York Times)",
                    renderer: default_polygon_renderer,
                    visible: true,
                });

                var illinois_hospitals = new GeoJSONLayer({
                    url: illinois_hospitals_url,
                    outFields: ["*"],
                    title: "Hospital Locations",
                    renderer: {
                        type: "simple",
                        symbol: {
                            type: "picture-marker", // autocasts as new PictureMarkerSymbol()
                            url: "img/hospital.png",
                            width: "32px",
                            height: "32px"
                        }
                    },
                    visible: false,
                });

                var illinois_testing = new GeoJSONLayer({
                    url: illinois_testing_url,
                    outFields: ["*"],
                    title: "Testing Cases",
                    renderer: {
                        type: "unique-value",
                        field: "Test_Result",
                        uniqueValueInfos: [{
                            value: "Positive",
                            symbol: {
                                type: "simple-marker",
                                size: 12,
                                color: "red",
                            }
                        }, {
                            value: "Negative",
                            symbol: {
                                type: "simple-marker",
                                size: 12,
                                color: "blue",
                            }
                        }]
                    },
                    visible: false,
                });

                // Some Layer Types can NOT be published on ArcGIS Online
                // https://developers.arcgis.com/documentation/core-concepts/layers/
                // references an ArcGIS Online item pointing to a Map Service Layer
                var illinois_access_layer = new MapImageLayer({
                    url:
                        "https://dev.rmms.illinois.edu/iepa/rest/services/wherecovid19/acc_il/MapServer",
                    title: "Accessibility Measure (State-wide)",
                    visible: false,
                    listMode: "hide-children",
                });


                var chicago_access_layer = new MapImageLayer({
                    url:
                        "https://dev.rmms.illinois.edu/iepa/rest/services/wherecovid19/acc_chicago/MapServer",
                    title: "Accessibility Measure (Chicago)",
                    visible: false,
                    listMode: "hide-children",
                });

                // order matters! last layer is at top
                var animation_layers = [nyt_layer_states, nyt_layer_counties, illinois_report];
                var static_layers = [illinois_hospitals, illinois_testing, illinois_counties, illinois_zipcode];

                // // new GroupLayer object may affect other GroupLayer objects
                // // Comment out unused GroupLayer objects to avoid strange bugs
                // // like group layer can not expand!!!!!
                // var animationGroupLayer = new GroupLayer({
                //     title: "Time-enabled Layers",
                //     visible: true,
                //     visibilityMode: "exclusive",
                //     layers: new Array().concat(animation_layers),
                //     opacity: 0.75
                // });
                // var staticGroupLayer = new GroupLayer({
                //     title: "Static Layers",
                //     visible: true,
                //     visibilityMode: "exclusive",
                //     layers: new Array().concat(static_layers),
                //     opacity: 0.75
                // });

                // new GroupLayer object may affect other GroupLayer objects
                // Comment out unused GroupLayer objects to avoid strange bugs
                // like group layer can not expand!!!!
                // var allInOneGroupLayer = new GroupLayer({
                //     title: "Layers",
                //     visible: true,
                //     visibilityMode: "exclusive",
                //     layers: new Array().concat(animation_layers, static_layers),
                //     opacity: 0.75
                // });

                var us_group = new GroupLayer({
                    title: "US",
                    visible: false,
                    visibilityMode: "independent",
                    layers: [nyt_layer_states, nyt_layer_counties],
                    opacity: 0.75
                })

                var illinois_group = new GroupLayer({
                    title: "Illinois",
                    visible: true,
                    visibilityMode: "independent",
                    layers: [illinois_hospitals, illinois_testing, illinois_counties, illinois_zipcode,
                        illinois_access_layer, chicago_access_layer, illinois_report],
                    opacity: 0.75
                });

                // order mattes! last layer is at top
                //var all_layers = [animationGroupLayer, staticGroupLayer];
                //var all_layers = allInOneGroupLayer.layers;
                var all_layers = new Array().concat(animation_layers, static_layers);

                // A non-3857 basemap
                var basemap = new Basemap({
                    baseLayers: [
                        new MapImageLayer({
                            //url: "https://services.arcgisonline.com/arcgis/rest/services/Polar/Arctic_Ocean_Base/MapServer",
                            url: "https://geoappext.nrcan.gc.ca/arcgis/rest/services/BaseMaps/CBMT3978/MapServer",
                            title: "Basemap"
                        })
                    ],
                    title: "basemap",
                    id: "basemap"
                });

                var map = new Map({
                    //basemap: basemap,
                    basemap: {
                        portalItem: {
                            id: "4f2e99ba65e34bb8af49733d9778fb8e",
                        }
                    },
                    layers: [us_group, illinois_group],
                });

                // Set up callback function for active_animation_layer value change before any map things
                setupActiveAnimationLayerChangeCallback();

                // This event will be triggered once at startup as maps adds layers for the fist time
                // Listen for layer change: remove, add, reorder
                // https://developers.arcgis.com/javascript/latest/api-reference/esri-Map.html#layers
                map.allLayers.on("change", function (event) {
                    // this function will change active_animation_layer value
                    setActiveAnimationLayer(event);
                });

                var view = new MapView({
                    map: map,
                    container: "viewDiv",
                    //spatialReference: new SpatialReference(wkid: 3857}),
                    center: [-88.984300, 40.474679],
                    zoom: 5.5,
                    constraints: {
                        snapToZoom: false,
                        //minScale: 72223.819286,
                        rotationEnabled: false
                    },
                    // This ensures that when going fullscreen
                    // The top left corner of the view extent
                    // stays aligned with the top left corner
                    // of the view's container
                    resizeAlign: "top-left"
                });

                // All the resources in the MapView and the map have loaded. Now execute additional processes
                // https://developers.arcgis.com/javascript/latest/api-reference/esri-views-MapView.html
                // entry point after map is initialized
                view.when(setActiveAnimationLayer("view.when"));

                function addClass2Elem(elem, add, class_name) {
                    //https://stackoverflow.com/questions/639815/how-to-disable-all-div-content/25328170
                    //https://dojotoolkit.org/reference-guide/1.7/dojo/removeClass.html
                    if (add) {
                        if (!dojo.hasClass(elem, class_name)) {
                            dojo.addClass(elem, class_name);
                        }
                    } else {
                        dojo.removeClass(elem, class_name);
                    }
                }

                // Find the top visible layer obj in array filter_array
                function getTopVisibleLayer(layerCol, filter_array = []) {
                    // start from the end of the array (top)
                    for (let i = layerCol.items.length - 1; i >= 0; i--) {
                        let layer = layerCol.items[i];
                        if (layer.visible) {
                            if (layer.type == "group") {
                                let l = getTopVisibleLayer(layer.layers, filter_array);
                                if (l != null) {
                                    return l;
                                }
                            } else {
                                if (filter_array.length == 0) {
                                    return layer;
                                } else {
                                    if (filter_array.includes(layer)) {
                                        return layer
                                    }
                                }
                            }
                        }
                    }
                    return null;
                }

                // called when layer order changed in layerlist control or layer visibility changed
                function setActiveAnimationLayer(evt) {
                    stopAnimation();
                    // reset active_animation_layer
                    let topVisibleLayer = getTopVisibleLayer(map.layers, animation_layers);
                    mywatcher.set("active_animation_layer", topVisibleLayer);
                    //Setup hover effects
                    view.whenLayerView(topVisibleLayer).then(setupHoverTooltip);
                }

                // Listen for layer visibility change
                // may get triggered more than once in if GroupLayer is in "exclusive" mode (radio button)
                // LayerA on->off and LayerB off->on
                // https://developers.arcgis.com/javascript/latest/sample-code/sandbox/index.html?sample=animation-layer-visibility
                map.allLayers.forEach(function (item) {
                    item.watch("visible", function (visible) {
                        console.log(item.title, visible)
                        if (visible === true && item.type !== "group") {
                            map.layers.forEach(function (value) {

                                if (value.title === item.parent.title) {
                                    value.visible = true;
                                    value.layers.forEach(function (val) {
                                        if (val.title === item.title) {
                                            val.visible = true;
                                        } else {
                                            val.visible = false;
                                        }
                                    })
                                } else {
                                    value.visible = false;
                                    value.layers.forEach(function (val) {
                                        val.visible = false;
                                    })
                                }
                            });

                            if (item.title === chicago_access_layer.title) {
                                view.goTo({
                                    center: [-87.631721, 41.868428],
                                    zoom: 10,
                                })
                            } else if (item.parent.title === us_group.title || item.title === us_group.title) {
                                view.goTo({
                                    center: [-96.984300, 40.474679],
                                    zoom: 3
                                })
                            } else if (item.parent.title === illinois_group.title || item.title === illinois_group.title) {
                                view.goTo({
                                    center: [-88.984300, 40.474679],
                                    zoom: 6
                                })
                            }
                        } // if(visible === true){
                        setActiveAnimationLayer(item);
                    });
                });

                var layerlist = new LayerList({
                    view: view,
                    //listItemCreatedFunction: defineActions,
                    selectionEnabled: true,
                    visibleElements: {
                        statusIndicators: false
                    },
                });

                // function defineActions(event) {
                //     // The event object contains an item property.
                //     // is is a ListItem referencing the associated layer
                //     // and other properties. You can control the visibility of the
                //     // item, its title, and actions using this object.
                //
                //     var item = event.item;
                //
                //     if (item.title === "Pandemic" || item.title === "Census-2000") {
                //         // An array of objects defining actions to place in the LayerList.
                //         // By making this array two-dimensional, you can separate similar
                //         // actions into separate groups with a breaking line.
                //
                //         item.actionsSections = [
                //             [
                //                 {
                //                     title: "Go to full extent",
                //                     className: "esri-icon-zoom-out-fixed",
                //                     id: "full-extent"
                //                 },
                //                 {
                //                     title: "Layer information",
                //                     className: "esri-icon-description",
                //                     id: "information"
                //                 }
                //             ],
                //             [
                //                 {
                //                     title: "Increase opacity",
                //                     className: "esri-icon-up",
                //                     id: "increase-opacity"
                //                 },
                //                 {
                //                     title: "Decrease opacity",
                //                     className: "esri-icon-down",
                //                     id: "decrease-opacity"
                //                 }
                //             ]
                //         ];
                //     }
                // }
                //
                // layerlist.on("trigger-action", function (event) {
                //     // The layer visible in the view at the time of the trigger.
                //     console.log(event);
                //     let visibleLayer = event.item.layer;
                //
                //     // Capture the action id.
                //     var id = event.action.id;
                //
                //     if (id === "full-extent") {
                //         // if the full-extent action is triggered then navigate
                //         // to the full extent of the visible layer
                //         view.goTo(visibleLayer.fullExtent);
                //     } else if (id === "information") {
                //         // if the information action is triggered, then
                //         // open the item details page of the service layer
                //         window.open(visibleLayer.url);
                //     } else if (id === "increase-opacity") {
                //         // if the increase-opacity action is triggered, then
                //         // increase the opacity of the GroupLayer by 0.25
                //
                //         if (visibleLayer.opacity < 1) {
                //             visibleLayer.opacity += 0.25;
                //         }
                //     } else if (id === "decrease-opacity") {
                //         // if the decrease-opacity action is triggered, then
                //         // decrease the opacity of the GroupLayer by 0.25
                //
                //         if (visibleLayer.opacity > 0) {
                //             visibleLayer.opacity -= 0.25;
                //         }
                //     }
                //
                // });

                // var basemapGallery = new BasemapGallery({
                //     view: view,
                // });
                //
                //
                // view.ui.add(new Expand({
                //     view: view,
                //     content: basemapGallery,
                // }), "top-right");


                function numberWithCommas(x) {
                    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                }

                //setTotalDiv();
                function setTotalDiv() {
                    const query = nyt_layer_counties.createQuery();
                    const totalConfrimStat = {
                        onStatisticField: "today_case",
                        outStatisticFieldName: "Total_Cases",
                        statisticType: "sum"
                    };
                    const totalDeathStat = {
                        onStatisticField: "today_death",
                        outStatisticFieldName: "Total_Deaths",
                        statisticType: "sum"
                    };
                    query.outStatistics = [totalConfrimStat, totalDeathStat];
                    nyt_layer_counties.queryFeatures(query)

                        .then(function (response) {
                            //console.log(response);
                            var stats = response.features[0].attributes;
                            confirmDiv.getElementsByTagName('h3')[0].innerHTML = numberWithCommas(stats.Total_Cases);
                            deathDiv.getElementsByTagName('h3')[0].innerHTML = numberWithCommas(stats.Total_Deaths);
                        });

                    const list_query = nyt_layer_counties.createQuery();
                    list_query.orderByFields = ['today_case DESC'];
                    nyt_layer_counties.queryFeatures(list_query)
                        .then(function (response) {
                            //console.log(response);
                            var listDiv = document.getElementsByClassName('case-list')[0];
                            var template = document.getElementsByTagName('template')[0];
                            var result_list = response.features.map(function (value) {
                                return {
                                    county: value.attributes.NAME,
                                    state: value.attributes.state_name,
                                    cases: value.attributes.today_case,
                                };
                                //return value.NAME;
                            });
                            //console.log(result_list)
                            result = result_list.slice(0, 11);
                            result.forEach(function (value) {
                                var instance = template.content.cloneNode(true);
                                instance.querySelector('strong').textContent = numberWithCommas(value.cases);
                                instance.querySelectorAll('span')[2].textContent = value.county + "," + value.state;
                                listDiv.appendChild(instance);
                            });
                        });

                }

                // Zero-based Month: 0==Jan
                const dt_startConst = new Date(2020, 0, 14);
                var dt_start = dt_startConst;
                var dt_interval_unit = "day";


                function queryLayerDates(_layer) {
                    const list_query = _layer.createQuery();
                    //list_query.orderByFields = ['population DESC'];
                    list_query.returnGeometry = false;
                    list_query.num = 1;
                    list_query.outFields = ["dt_start", "dt_end", "dt_unit"];
                    return _layer.queryFeatures(list_query);
                }

                function initSlider(response) {
                    let feature0_attrs = response.features[0].attributes;
                    let _dt_start_str = feature0_attrs["dt_start"];
                    let _dt_end_str = feature0_attrs["dt_end"];

                    if (feature0_attrs.hasOwnProperty("dt_unit")) {
                        dt_interval_unit = feature0_attrs["dt_unit"];
                    } else {
                        dt_interval_unit = "day";
                    }

                    //dt_interval_unit = "day";
                    let _dt_end = locale.parse(_dt_end_str, {
                        datePattern: "yyyy-MM-dd",
                        selector: "date"
                    });
                    let _dt_start = locale.parse(_dt_start_str, {
                        datePattern: "yyyy-MM-dd",
                        selector: "date"
                    });
                    dt_start = _dt_start;

                    if (dt_interval_unit == "day") {
                        dt_start = dt_startConst;
                    }

                    let _slider_max = date.difference(dt_start, _dt_end, dt_interval_unit);
                    //console.log(_slider_max);


                    if (slider == null) {
                        slider = new Slider({
                            container: "slider",
                            min: 0,
                            max: _slider_max,
                            values: [_slider_max],
                            step: 1,
                            visibleElements: {
                                rangeLabels: true
                            },
                            draggableSegmentsEnabled: false,
                        });
                        slider.on("thumb-drag", inputHandler);
                    } else {
                        slider.min = 0;
                        slider.max = _slider_max;
                    }
                }

                function setupActiveAnimationLayerChangeCallback() {
                    // Watch changes on a property:
                    mywatcher.watch("active_animation_layer", onActiveAnimationLayerChange);
                }

                function onActiveAnimationLayerChange(name, oldValue, value) {
                    //console.log(name, oldValue, value);
                    if (value == null) {
                        addClass2Elem(sliderDiv, true, "hideDiv");

                        //Hide the chart
                        document.getElementById('myChart').classList.add("d-none");
                        document.getElementById('myChart').classList.remove("d-block");
                    } else {
                        if (value != oldValue) {
                            // enable slider div
                            addClass2Elem(sliderDiv, false, "hideDiv");
                            queryLayerDates(value).then(initSlider).then(function () {
                                let thumb_value = slider.values[0];
                                if (thumb_value > slider.max || thumb_value < slider.min) {
                                    thumb_value = slider.min;
                                }
                                let dt_thumb = date.add(dt_start, dt_interval_unit, thumb_value);

                                setDate(dt_thumb, animation_type = animation_type);
                            });
                        }
                    }
                }


                // When user drags the slider:
                //  - stops the animation
                //  - set the visualized year to the slider one.
                function inputHandler(event) {
                    //console.log("Drag");
                    stopAnimation();
                    let thumb_value = Math.floor(event.value);
                    //console.log(thumb_value);
                    let dt_thumb = date.add(dt_start, dt_interval_unit, thumb_value);
                    //console.log(dt_thumb);
                    setDate(dt_thumb, animation_type = animation_type);
                }

                // Toggle animation on/off when user
                // clicks on the play button
                playButton.addEventListener("click", function () {
                    if (playButton.classList.contains("toggled")) {
                        stopAnimation();
                    } else {
                        startAnimation();
                    }
                });

                view.ui.empty("top-left");
                view.ui.add(layerlist, "top-left");
                //view.ui.add(titleDiv, "top-left");

                view.ui.add(
                    new Zoom({
                        view: view
                    }),
                    "top-right"
                );
                view.ui.add(
                    new Home({
                        view: view
                    }),
                    "top-right"
                );
                view.ui.add(
                    new Legend({
                        view: view
                    }),
                    "bottom-right"
                );
                view.ui.add(
                    new Fullscreen({
                        view: view,
                        element: applicationDiv
                    }),
                    "top-right"
                );

                view.popup.autoCloseEnabled = true;

                // When the layerview is available, setup hovering interactivity
                //view.whenLayerView(active_animation_layer).then(setupHoverTooltip);

                var animation_dropdown = document.getElementById("animation_dropdown");
                var animation_type = animation_dropdown.value;
                //setDate(dt_start, animation_type = animation_type);
                //setDate(dt_start, animation_type="first_case");

                animation_dropdown.addEventListener("change", function (evt) {
                    //console.log(evt);
                    animation_type = evt.target.value;
                    let thumb_value = Math.ceil(slider.values[0]);

                    let current_date = date.add(dt_start, dt_interval_unit, thumb_value);
                    setDate(current_date, animation_type = animation_type);
                });


                var ilZipTemplate = {
                    expressionInfos: [{
                        name: "zipcode",
                        title: "Zip Code",
                        expression: "Text($feature.ZipCode)"
                    },],

                    title: "{expression/zipcode}",

                    content: [{
                        type: "fields", // FieldsContentElement
                        fieldInfos: [{
                            fieldName: "ZipCode",
                            visible: true,
                            label: "Zip Code"
                        }, {
                            fieldName: "MainCity",
                            visible: true,
                            label: "Main City"
                        }, {
                            fieldName: "FIPS",
                            visible: true,
                            label: "FIPS"
                        }, {
                            fieldName: "population",
                            visible: true,
                            label: "Population"
                        }, {
                            fieldName: "ZipCodeForecast",
                            visible: true,
                            label: "Forecast New Cases (week Apr 5-11, 2020)"
                        }]
                    }]
                };

                illinois_zipcode.popupTemplate = ilZipTemplate;

                var ilCountyTemplate = {

                    title: "{NAME}",

                    content: [{
                        type: "fields", // FieldsContentElement
                        fieldInfos: [

                            {
                                fieldName: "FIPS",
                                visible: true,
                                label: "FIPS"
                            }, {
                                fieldName: "population",
                                visible: true,
                                label: "Population"
                            }, {
                                fieldName: "CountyForecast",
                                visible: true,
                                label: "Forecast New Cases (week Apr 5-11, 2020)"
                            }, {
                                fieldName: "Number_Booths",
                                visible: true,
                                label: "Booths"
                            }

                        ]
                    }]
                };

                illinois_counties.popupTemplate = ilCountyTemplate;

                var ilHospitalTemplate = {

                    title: "{Hospital}",

                    content: [{
                        type: "fields", // FieldsContentElement
                        fieldInfos: [

                            {
                                fieldName: "StreetAddress",
                                visible: true,
                                label: "Address"
                            }, {
                                fieldName: "City",
                                visible: true,
                                label: "City"
                            }, {
                                fieldName: "ZIP_Code",
                                visible: true,
                                label: "Zip Code"
                            }, {
                                fieldName: "Total_Bed",
                                visible: true,
                                label: "Total Beds"
                            }, {
                                fieldName: "AvailableBed",
                                visible: true,
                                label: "Available Beds"
                            }, {
                                fieldName: "Bed_in_Use",
                                visible: true,
                                label: "Bed in use"
                            }, {
                                fieldName: "Adult_ICU_Bed",
                                visible: true,
                                label: "Adult ICU Beds"
                            }, {
                                fieldName: "Total_Vent",
                                visible: true,
                                label: "Total Vents"
                            }, {
                                fieldName: "Available_Vent",
                                visible: true,
                                label: "Available Vents"
                            }, {
                                fieldName: "Vent_in_Use",
                                visible: true,
                                label: "Vent in Use"
                            }, {
                                fieldName: "CovidConfirmedPatient",
                                visible: true,
                                label: "Confirmed COVID-19 Patients"
                            }, {
                                fieldName: "CovidPatient_in_ICU",
                                visible: true,
                                label: "COVID-19 Patients in ICU"
                            }, {
                                fieldName: "CovidPatientVent",
                                visible: true,
                                label: "COVID-19 Patients Vent"
                            },

                        ]
                    }]
                };
                illinois_hospitals.popupTemplate = ilHospitalTemplate;

                var ilTestingTemplate = {

                    title: "Test Cases",

                    content: [{
                        type: "fields", // FieldsContentElement
                        fieldInfos: [

                            {
                                fieldName: "Test_Result",
                                visible: true,
                                label: "Test Result"
                            }, {
                                fieldName: "expression/lab_date",
                            }, {
                                fieldName: "age",
                                visible: true,
                                label: "Age"
                            }, {
                                fieldName: "Sex",
                                visible: true,
                                label: "Gender"
                            }, {
                                fieldName: "Deceased",
                                visible: true,
                                label: "Deceased"
                            }
                        ]
                    }
                    ],
                    expressionInfos: [
                        {
                            // Wed, 18 Mar 2020 00:00:00 GMT --> Wed, 18 Mar 2020
                            name: "lab_date",
                            title: "Lab Report Date",
                            expression: "Replace($feature.Lab_Report_Date, ' 0:00', '')"
                        },
                    ],
                };

                illinois_testing.popupTemplate = ilTestingTemplate;

                var usStateTemplate = {

                    title: "{NAME}",
                    expressionInfos: [
                        {
                            name: "total_cases",
                            title: "Total Confirmed Cases",
                            expression: "Round(Split($feature.cases_ts, ',')[-1])"
                        },
                        {
                            name: "total_deaths",
                            title: "Total Deaths",
                            expression: "Round(Split($feature.deaths_ts, ',')[-1])"
                        },
                        {
                            name: "death_rate",
                            title: "Death Rate (%)",
                            expression: "Round((Split($feature.deaths_ts, ',')[-1]/Split($feature.cases_ts, ',')[-1])*100,2)"
                        }

                    ],
                    content: [
                        {
                            type: "fields", // FieldsContentElement
                            fieldInfos: [

                                {
                                    fieldName: "expression/total_cases",
                                    visible: true,
                                    label: "Confirmed Cases"
                                },
                                {
                                    fieldName: "expression/total_deaths",
                                    visible: true,
                                    label: "Deaths"
                                },
                                {
                                    fieldName: "expression/death_rate",
                                    visible: true,
                                    label: "Death Rate"
                                },
                                {
                                    fieldName: "dt_first_case",
                                    visible: true,
                                    label: "First Date of Confirmed Cases"
                                },
                                {
                                    fieldName: "dt_first_death",
                                    visible: true,
                                    label: "First Date of Deaths"
                                },
                                {
                                    fieldName: "population",
                                    visible: true,
                                    label: "Population"
                                }

                            ]
                        }
                    ]
                };

                nyt_layer_states.popupTemplate = usStateTemplate;


                var usCountyTemplate = {

                    title: "{NAME}",

                    expressionInfos: [
                        {
                            name: "total_cases",
                            title: "Total Confirmed Cases",
                            expression: "Round(Split($feature.cases_ts, ',')[-1])"
                        },
                        {
                            name: "total_deaths",
                            title: "Total Deaths",
                            expression: "Round(Split($feature.deaths_ts, ',')[-1])"
                        },
                        {
                            name: "death_rate",
                            title: "Death Rate (%)",
                            expression: "Round((Split($feature.deaths_ts, ',')[-1]/Split($feature.cases_ts, ',')[-1])*100,2)"
                        }

                    ],
                    content: [
                        {
                            type: "fields", // FieldsContentElement
                            fieldInfos: [

                                {
                                    fieldName: "fips",
                                    visible: true,
                                    label: "FIPS"
                                },
                                {
                                    fieldName: "state_name",
                                    visible: true,
                                    label: "State"
                                },
                                {
                                    fieldName: "expression/total_cases",
                                    visible: true,
                                    label: "Confirmed Cases"
                                },
                                {
                                    fieldName: "expression/total_deaths",
                                    visible: true,
                                    label: "Deaths"
                                },
                                {
                                    fieldName: "expression/death_rate",
                                    visible: true,
                                    label: "Death Rate"
                                },
                                {
                                    fieldName: "dt_first_case",
                                    visible: true,
                                    label: "First Date of Confirmed Cases"
                                },
                                {
                                    fieldName: "dt_first_death",
                                    visible: true,
                                    label: "First Date of Deaths"
                                },
                                {
                                    fieldName: "population",
                                    visible: true,
                                    label: "Population"
                                }

                            ]
                        }
                    ]
                };

                nyt_layer_counties.popupTemplate = usCountyTemplate;


                // Create tooltip
                function createTooltip() {

                    var tooltip = document.createElement("div");
                    var style = tooltip.style;

                    tooltip.setAttribute("role", "tooltip");
                    tooltip.classList.add("tooltip");

                    var textElement = document.createElement("div");
                    textElement.classList.add("esri-widget");
                    tooltip.appendChild(textElement);

                    view.container.appendChild(tooltip);

                    var x = 0;
                    var y = 0;
                    var targetX = 0;
                    var targetY = 0;
                    var visible = false;

                    // move the tooltip progressively
                    function move() {
                        x += (targetX - x) * 0.1;
                        y += (targetY - y) * 0.1;

                        if (Math.abs(targetX - x) < 1 && Math.abs(targetY - y) < 1) {
                            x = targetX;
                            y = targetY;
                        } else {
                            requestAnimationFrame(move);
                        }
                        style.transform =
                            "translate3d(" + Math.round(x) + "px," + Math.round(y) + "px, 0)";
                    }

                    return {
                        show: function (point, text) {
                            if (!visible) {
                                x = point.x;
                                y = point.y;
                            }

                            targetX = point.x;
                            targetY = point.y;
                            style.opacity = 1;
                            visible = true;
                            textElement.innerHTML = text;

                            move();
                        },

                        hide: function () {
                            style.opacity = 0;
                            visible = false;
                        }
                    };
                }

                // When the layerview is available, setup hovering interactivity
                var tooltip = null;
                var hitTest = null;
                var hoverover_callback = null;
                var activeAnimationLayerView = null;

                function setupHoverTooltip(layerview) {

                    var highlight;
                    activeAnimationLayerView = layerview;

                    // if (tooltip == null) {
                    //     tooltip = createTooltip();
                    // }

                    if (hitTest == null) {
                        hitTest = promiseUtils.debounce(function (event) {
                            return view.hitTest(event).then(function (hit) {
                                var results = hit.results.filter(function (result) {
                                    return result.graphic.layer === activeAnimationLayerView.layer;
                                });

                                if (!results.length) {
                                    return null;
                                }

                                return {
                                    graphic: results[0].graphic,
                                    screenPoint: hit.screenPoint
                                };
                            });
                        });
                    }
                    if (hoverover_callback == null) {
                        view.on("click", function (event) {
                            //view.on("pointer-move", function (event) {
                            return hitTest(event).then(
                                function (hit) {
                                    // remove current highlighted feature
                                    if (highlight) {
                                        highlight.remove();
                                        highlight = null;
                                    }

                                    // highlight the hovered feature
                                    // or hide the tooltip

                                    if (hit) {
                                        if (window.bar != undefined) {
                                            window.bar.destroy();
                                        }

                                        // Add d-block class and remove d-none to display the chart
                                        document.getElementById('myChart').classList.add("d-block");
                                        document.getElementById('myChart').classList.remove("d-none");

                                        var graphic = hit.graphic;
                                        var screenPoint = hit.screenPoint;
                                        //var myChart = document.getElementById('myChart').getContext('2d');
                                        //var infoWindow = document.getElementById('infoWindow');

                                        Chart.defaults.global.defaultFontSize = 15;
                                        Chart.defaults.global.defaultFontColor = '#777';

                                        var CasesArray = (graphic.getAttribute("cases_ts")).split(",");
                                        var DeathsArray = (graphic.getAttribute("deaths_ts")).split(",");

                                        var IncreasedCases = [];
                                        for (i = 1; i < CasesArray.length; i++) {
                                            IncreasedCases.push(CasesArray[i] - CasesArray[i - 1])
                                        }
                                        ;
                                        IncreasedCases.unshift(0);

                                        var IncreasedDeaths = [];
                                        for (i = 1; i < DeathsArray.length; i++) {
                                            IncreasedDeaths.push(DeathsArray[i] - DeathsArray[i - 1])
                                        }
                                        ;
                                        IncreasedDeaths.unshift(0);

                                        var ExtendedCasesArray = CasesArray.slice(0)
                                        var ExtendedDeathsArray = DeathsArray.slice(0)
                                        ExtendedCasesArray.unshift(0, 0, 0, 0, 0, 0, 0)
                                        ExtendedDeathsArray.unshift(0, 0, 0, 0, 0, 0, 0)

                                        var ExtendedIncreasedCases = IncreasedCases.slice(0)
                                        var ExtendedIncreasedDeaths = IncreasedDeaths.slice(0)
                                        ExtendedIncreasedCases.unshift(0, 0, 0, 0, 0, 0, 0)
                                        ExtendedIncreasedDeaths.unshift(0, 0, 0, 0, 0, 0, 0)

                                        var LabelDates = [];
                                        var LabelDate = new Date(2020, 0, 13);
                                        for (i = 0; i < ExtendedCasesArray.length; i++) {
                                            LabelDate.setDate(LabelDate.getDate() + 1);
                                            LabelDates.push(LabelDate.toLocaleDateString());
                                        }
                                        ;

                                        // var InfoWindowDate = new Date(2020, 0, 14);
                                        // InfoWindowDate.setDate(InfoWindowDate.getDate() + slider.values[0]);
                                        // var InfoWindowDateStr = InfoWindowDate.toLocaleDateString();

                                        // infoWindow.innerHTML = "Cases on " + InfoWindowDateStr + ": " + Math.round(ExtendedCasesArray[slider.values[0]]) + "<br>" +
                                        //     "Deaths on " + InfoWindowDateStr + ": " + Math.round(ExtendedDeathsArray[slider.values[0]]);

                                        const verticalLinePlugin = {
                                            getLinePosition: function (chart, pointIndex) {
                                                const meta = chart.getDatasetMeta(0); // first dataset is used to discover X coordinate of a point
                                                const data = meta.data;
                                                return data[pointIndex]._model.x;
                                            },
                                            renderVerticalLine: function (chartInstance, pointIndex) {
                                                const lineLeftOffset = this.getLinePosition(chartInstance, pointIndex);
                                                const scale = chartInstance.scales['y-axis-0'];
                                                const context = chartInstance.chart.ctx;

                                                // render vertical line
                                                context.beginPath();
                                                context.strokeStyle = '#ffffff';
                                                context.setLineDash([10, 5]);
                                                context.moveTo(lineLeftOffset, scale.top);
                                                context.lineTo(lineLeftOffset, scale.bottom);
                                                context.stroke();

                                                // write label
                                                context.fillStyle = "#ffffff";
                                                context.textAlign = 'right';
                                                context.fillText('Current Day ', lineLeftOffset, (scale.bottom - scale.top) / 2 + scale.top);
                                            },

                                            afterDatasetsDraw: function (chart, easing) {
                                                if (chart.config.lineAtIndex) {
                                                    chart.config.lineAtIndex.forEach(pointIndex => this.renderVerticalLine(chart, pointIndex));
                                                }
                                            }
                                        };

                                        Chart.plugins.register(verticalLinePlugin);

                                        window.bar = new Chart(myChart, {
                                            type: 'line',
                                            data: {
                                                labels: LabelDates,
                                                datasets: [{
                                                    data: ExtendedCasesArray,
                                                    label: "Confirmed Cases",
                                                    borderColor: "#ffab24",
                                                    fill: false
                                                }, {
                                                    data: ExtendedIncreasedCases,
                                                    label: "Increased Cases",
                                                    borderColor: "#f25100",
                                                    fill: false
                                                }, {
                                                    data: ExtendedDeathsArray,
                                                    label: "Deaths",
                                                    borderColor: "#a10025",
                                                    fill: false
                                                }, {
                                                    data: ExtendedIncreasedDeaths,
                                                    label: "Increased Deaths",
                                                    borderColor: "#6a28c7",
                                                    fill: false
                                                }]
                                            },
                                            options: {
                                                title: {
                                                    display: false,
                                                    text: 'COVID19 Time Series',
                                                    fontSize: 15
                                                },
                                                legend: {
                                                    position: 'top',
                                                    fullWidth: true,
                                                    labels: {
                                                        fontSize: 12
                                                    }
                                                },
                                                fontSize: 12,
                                                responsive: true,
                                                maintainAspectRatio: false
                                            }
                                            //lineAtIndex: [slider.values[0]]
                                        });

                                        highlight = activeAnimationLayerView.highlight(graphic);
                                        console.log(graphic);
                                        console.log(screenPoint);
                                        // tooltip.show(
                                        //     screenPoint,
                                        //     "Cases in " + graphic.getAttribute("NAME")
                                        // );
                                    } else {
                                        // tooltip.hide();
                                    }
                                },
                                function () {
                                }
                            );
                        });
                        hoverover_callback = true;
                    }

                }

                //--------------------------------------------------------------------------
                //
                //  Methods
                //
                //--------------------------------------------------------------------------

                /**
                 * Sets the current visualized construction year.
                 */
                function setDate(_date, animation_type = "case") {
                    let level = null;
                    animation_layers.forEach(function (value) {
                        if (value.visible == true && value.parent.visible == true) {
                            console.log(value.title);
                            if (value.title == illinois_report.title) {
                                level = "illinois"
                            } else if (value.title == nyt_layer_counties.title) {
                                level = "county";
                            } else if (value.title == nyt_layer_states.title) {
                                level = "state";
                            }
                        }
                    })
                    if (dt_interval_unit == "week") {
                        dt_week_end = date.add(_date, "week", 1);
                        sliderValue.innerHTML = locale.format(_date, {
                                datePattern: "MM/dd",
                                selector: "date"
                            }) +
                            "-" + locale.format(dt_week_end, {
                                datePattern: "MM/dd/yyyy",
                                selector: "date"
                            });
                    } else {
                        sliderValue.innerHTML = locale.format(_date, {
                            datePattern: "MM/dd/yyyy",
                            selector: "date"
                        });
                    }

                    var thumb_value = date.difference(dt_start, _date, dt_interval_unit);
                    slider.viewModel.setValue(0, thumb_value);
                    let _layer = mywatcher.get("active_animation_layer");

                    // let event_type = document.querySelector('input[name="dataOptions"]:checked').value;
                    // let if_log = document.querySelector('input[name="logOptions"]:checked').value;
                    // let method = document.querySelector('input[name="renderOptions"]:checked').value;
                    let event_type = "case"
                    let if_log = "nolog"
                    let method = "NaturalBreaks"

                    if (_layer == null) {
                        return;
                    }
                    _layer.renderer = classRender(_date, _event_type = event_type, _if_log = if_log, _method = method, _level = level);

                    // if (animation_type == "case") {
                    //     _layer.renderer = dailyEventNumberRender(_date, _event_type = "case", _scale = "loge");
                    // } else if (animation_type == "death" || animation_type == "death/case" ||
                    //     animation_type == "new_case" || animation_type == "new_death") {
                    //     _layer.renderer = dailyEventNumberRender(_date, _event_type = animation_type, _scale = "");
                    // } else {
                    //     let event_type = "case";
                    //     if (animation_type == "first_death") {
                    //         event_type = "death"
                    //     }

                    //     _layer.renderer = classRender(_date, _event_type = event_type, _if_log = if_log, _method = method, _level = level);
                    // }

                    //covid19_layer.renderer = dailyEventNumberRender(_date, _event_type="death/case", _scale="");
                    //covid19_layer.renderer = firstEventRender(_date, _event_type="Deaths");
                }

                function getDailyEventNumberArcade(_date, _event_type = "case", _scale = "") { // get accumulated Case Number
                    return `
          // be sure to use .getDate() for Day value!  NOT .getDay()!!!!!!!
          var d_thumb = Date(${_date.getFullYear()},${_date.getMonth()},${_date.getDate()});
          var event_type = '${_event_type}';
          event_type = Lower(event_type);
          var scale = '${_scale}';
          //Console(d_thumb);
          //Console($feature);

          var population = DefaultValue($feature.population, 0);

          var cases_num=0;
          var deaths_num=0;
          var cases_num_yesterday=0;
          var deaths_num_yesterday=0;
          var final_return_value = 0;


          if (IsEmpty($feature['cases_ts']))
          {
              cases_num = 0;
              deaths_num = 0;
              cases_num_yesterday=0;
              deaths_num_yesterday=0;
          }
          else
          {
            var dt_start_array = Split($feature.dt_start, '-');
            var dt_start = Date(Number(dt_start_array[0]), Number(dt_start_array[1])-1, Number(dt_start_array[2]));
              if (d_thumb < dt_start)
              {
                 cases_num = 0;
                 deaths_num = 0;
                 cases_num_yesterday=0;
                 deaths_num_yesterday=0;
              }
              else
              {
                  //var cases_ts_array = Dictionary($feature["cases_ts"]).values;
                  //var deaths_ts_array = Dictionary($feature["deaths_ts"]).values;
                  var cases_ts_array = Split($feature["cases_ts"], ',');
                  var deaths_ts_array = Split($feature["deaths_ts"], ',');


                  var days=DateDiff(d_thumb, dt_start, "days");
                  var index = Ceil(days);
                  //Console(days);
                  if(HasKey($feature, "dt_unit"))
                  {
                    if($feature["dt_unit"]=="week")
                    {
                      index=Ceil(days/7);
                    }
                  }

                  cases_num = Number(cases_ts_array[index]);
                  deaths_num = Number(deaths_ts_array[index]);
                  if(index>0)
                  {
                    cases_num_yesterday=Number(cases_ts_array[index-1]);
                    deaths_num_yesterday=Number(deaths_ts_array[index-1]);
                  }
                  else
                  {
                    cases_num_yesterday=cases_num;
                    deaths_num_yesterday=deaths_num;
                  }

              } //if (d_thumb < dt_start)
          } //if (fea_dt_start==-1)

          if (event_type=="case")
          {
             final_return_value = cases_num;
          }
          else if (event_type=="death")
          {
             final_return_value = deaths_num;
          }
          else if (event_type=="death/case")
          {
             if (cases_num>0)
             {
                final_return_value = deaths_num/cases_num;
             }
             else
             {
                final_return_value=0;
             }
          }
          else if(event_type=="case/population")
          {
             if (population >0 )
             {
             final_return_value = cases_num/population;
             }
             else
             {
             final_return_value=0;
             }
          }
          else if(event_type=="death/population")
          {
             if(population >0 )
             {
             final_return_value = deaths_num/population;
             }
             else
             {
             final_return_value=0;
             }
          }
          else if(event_type=="new_case")
          {
             final_return_value = cases_num - cases_num_yesterday;
          }
          else if(event_type=="new_death")
          {
             final_return_value = deaths_num - deaths_num_yesterday;
          }
          else
          {
             final_return_value = 0;
          }

          // scaling
          if (scale=="loge")
            {
            final_return_value = Log(final_return_value+1);
            }

            //Console(final_return_value);
            return final_return_value;

          `;
                }

                // Deprecated
                function getDailyEventNumberArcade2(_date) {
                    // get accumulated Case Number if daily increase is stored
                    return `
        // start date; Month 0-based in Arcade Date class
        // be sure to use .getDate() for Day value!  NOT .getDay()!!!!!!!
        var end_dt = Date(${_date.getFullYear()},${_date.getMonth()},${_date.getDate()});
        //var end_dt = Date(2020,2,26);
        var start_dt = Date(2020,0,21);
        var days=DateDiff(end_dt, start_dt, "days");
        var sum=0;
        for(var i=0; i<=days; i++) {
        var d = DateAdd(start_dt, i, "days");
        var key=Text(d, "FY_MM_DD");
        // if attribute value is null, use 0
        var day_value = IIf(IsEmpty($feature[key]), 0, $feature[key]);
        sum += day_value;
        }
        return sum;

            `;
                }

                function dailyEventNumberRender(_date, _event_type = "case", _scale = "") {

                    const colors = ["#000000", "#fef0d9", "#fdcc8a", "#fc8d59", "#e34a33", "#b30000"];
                    let stops = [0, 0.01, 0.05, 0.10, 0.15, 0.2];
                    let labels = ["0", "1%", "5%", "10%", "15%", "20%"];

                    let event_type = _event_type.toLowerCase();

                    if (event_type == "case") {
                        //let case_max = Math.max.apply(Math, counties_data.metadata.cases);
                        let case_max = 500;

                        let interval = Math.ceil(case_max / 20);
                        stops = [0, 1, interval, 2 * interval, 3 * interval, case_max];
                        labels = stops.map(x => x.toString());
                        stops = [0, 1, interval, 2 * interval, 3 * interval, case_max];
                        stops = stops.map(x => Math.log(x));

                    } else if (event_type == "death") {
                        //let death_max = Math.max.apply(Math, counties_data.metadata.deaths);
                        let death_max = 200;

                        let interval = Math.ceil(death_max / 10);
                        stops = [0, 1, interval, 2 * interval, 3 * interval, death_max];
                        labels = stops.map(x => x.toString());

                    } else if (event_type == "death/case") {
                        stops = [0, 0.01, 0.05, 0.10, 0.15, 0.2];
                        labels = ["0", "1%", "5%", "10%", "15%", "20%"];
                    } else {
                        stops = [0, 1, 100, 500, 1000, 5000];
                        labels = stops.map(x => x.toString());

                    }

                    let stops_array = [];
                    for (let i = 0; i < colors.length; i++) {
                        let stop_item = {
                            value: stops[i],
                            color: colors[i],
                            label: labels[i].toString()
                        };
                        stops_array.push(stop_item);
                    }


                    return {
                        type: "simple",
                        symbol: {
                            type: "simple-fill",
                            color: [0, 0, 0, 0],
                            outline: { // autocasts as new SimpleLineSymbol()
                                color: [128, 128, 128, 0.5],
                            }
                        },
                        visualVariables: [{
                            type: "color",
                            //field: 'F'+String(_date.getFullYear()).padStart(4, '0')+"_"+String(_date.getMonth()+1).padStart(2, '0')+"_"+String(_date.getDate()).padStart(2, '0'),
                            valueExpression: getDailyEventNumberArcade(_date, _event_type = _event_type, _scale = _scale),
                            //normalizationField: "population",
                            valueExpressionTitle: _event_type,
                            stops: stops_array.reverse(),
                        }]
                    };
                }

                function firstEventRender(_date, _event_type = "Case") {

                    return {
                        type: "simple",
                        symbol: {
                            type: "simple-fill",
                            color: [0, 0, 0, 0],
                            outline: { // autocasts as new SimpleLineSymbol()
                                color: [128, 128, 128, 0.5],
                            }
                        },
                        visualVariables: [{
                            type: "color",
                            valueExpression: firstEventArcade(_date, _event_type = _event_type),
                            //valueExpressionTitle: "Voter Turnout",
                            stops: [{
                                value: 1,
                                color: [241, 138, 98, 1],
                                label: _event_type + "(s) Reported"
                            }, {
                                value: 0,
                                color: [0, 255, 255, 1],
                                label: "First " + _event_type
                            }, {
                                value: -1,
                                //color: "#000000",
                                color: [0, 0, 0, 0],
                                label: "No " + _event_type
                            },],
                        }]
                    };
                }

                function classRender(_date, _event_type = "case", _if_log = "nolog", _method = "Quantiles", _level = "county") {
                    const colors = ["#fef0d9", "#fdd49e", "#fdbb84", "#fc8d59", "#e34a33", "#b30000"];
                    const background_color = [0, 0, 0];
                    let constant_class = classes_data;
                    let dynamic_class = dynamic_classes_data;
                    //Now set default method as Quantiles
                    if(_level == "county"){
                        _method = "Quantiles";
                    }
                    let source = null;
                    // 5 Common type: Constant Classes
                    if (_event_type == "case" || _event_type == "death" || _event_type == "case_per_100k_capita"
                        || _event_type == "death_per_100k_capita" || _event_type == "death_case_ratio") {
                        source = constant_class[_level][_event_type][_if_log][_method];
                        let bins = source.bins.split(",")
                        let stop_array = [{
                            value: -1,
                            color: background_color,
                            label: 0
                        }];
                        // bins.length <= colors.length
                        // e.g. if only 2 classes, get [4,5] colors
                        for (let i = 0; i < bins.length; i++) {
                            var label = bins[i];
                            if (parseFloat(label) < 0) {
                                label = parseFloat(label);
                            } else {
                                label = parseInt(label);
                            }
                            stop_array.push({
                                value: i,
                                color: colors[i],
                                label: label,
                            })
                        }
                        return {
                            type: "simple",
                            symbol: {
                                type: "simple-fill",
                                outline: {  // autocasts as new SimpleLineSymbol()
                                    color: [128, 128, 128, 50],
                                }
                            },
                            visualVariables: [
                                {
                                    type: "color",
                                    valueExpression: classArcade(_date, _class = bins, _event_type = _event_type, _if_log = _if_log),
                                    //valueExpressionTitle: "Voter Turnout",
                                    stops: stop_array.reverse(),
                                }
                            ]
                        };

                    }
                    // Two Situation: Dynamic Classes
                    else if (_event_type == "new_case" || _event_type == "new_death") {
                        console.log(dynamic_class)
                        source = dynamic_class[_level][_event_type];

                        return {
                            type: "simple",
                            symbol: {
                                type: "simple-fill",
                                outline: {  // autocasts as new SimpleLineSymbol()
                                    color: [128, 128, 128, 0],
                                }
                            },
                            visualVariables: [
                                {
                                    type: "color",
                                    valueExpression: dynamicClassArcade(_date, _class = bins, _event_type = _event_type),
                                    //valueExpressionTitle: "Voter Turnout",
                                    stops: stop_array.reverse(),
                                }
                            ]
                        };
                    }


                }

                function classArcade(_date, _class, _event_type = "case", _if_log = "nolog") {

                    // Drew: return must be followed by the open ` on the same line, and a semi-colon ";" is required after the close `!!!
                    return `
                        //be sure to use .getDate() for Day value!  NOT .getDay()!!!!!!!

                        var dt_thumb = Date(${_date.getFullYear()}, ${_date.getMonth()}, ${_date.getDate()});
                        var event_type = Lower('${_event_type}');
                        var if_log = Lower('${_if_log}');
                        var val = 0;
                        var class = 0;
                        var bins = [${_class}];
                        var population = Number($feature['population'])/100000;
                        var dt_start_array = Split($feature.dt_start, '-');
                        var dt_start = Date(Number(dt_start_array[0]), Number(dt_start_array[1])-1, Number(dt_start_array[2]));
                        if(dt_thumb < dt_start){
                            class = -1;
                            return class;
                        }
                        var days=DateDiff(dt_thumb, dt_start, "days");
                        var index = Ceil(days);

                            
                        if(event_type == "case" || event_type == "case_per_100k_capita"){
                            var case_ts = Split($feature['cases_ts'],',');
                            val = case_ts[index];
                            if(if_log == "log"){
                                val = Log(val + 1);
                            }
                            if(event_type == "case_per_100k_capita"){
                                val = val/population;
                            }
                        }
                        else if(event_type == "death" || event_type == "death_per_100k_capita"){
                            var death_ts = Split($feature['deaths_ts'],',');
                            val = death_ts[index];
                            if(if_log == "log"){
                                val = Log(val + 1);
                            }
                            if(event_type == "death_per_100k_capita"){
                                val = val/population;
                            }
                        }
                        // else if(event_type == "death_case_ratio"){
                        //     var case_ts = Split($feature['cases_ts'],',');
                        //     var death_ts = Split($feature['deaths_ts'],',');
                        //     val = death_ts[index]/case_ts[index];
                        // }
                        for(var x = 0; x < Count(bins); x ++){
                            if(val <= 0){
                                class = -1;
                                break;
                            }
                            if(val <= Number(bins[x])){
                                class = x;
                                break;
                            }
                        }
                        return class;
                    `;
                }

                function dynamicClassArcade(_date, _class, _event_type = "case") {

                    // Drew: return must be followed by the open ` on the same line, and a semi-colon ";" is required after the close `!!!
                    return `
                        //be sure to use .getDate() for Day value!  NOT .getDay()!!!!!!!

                        var dt_thumb = Date(${_date.getFullYear()}, ${_date.getMonth()}, ${_date.getDate()});
                        var event_type = Lower('${_event_type}');
                        var val = 0;
                        var class = 0;
                        var population = Number($feature['population'])/100000;
                        var dt_start_array = Split($feature.dt_start, '-');
                        var dt_start = Date(Number(dt_start_array[0]), Number(dt_start_array[1])-1, Number(dt_start_array[2]));
                        if(dt_thumb < dt_start){
                            class = -1;
                            return class;
                        }
                        var days=DateDiff(dt_thumb, dt_start, "days");
                        var index = Ceil(days);
                        // New Case & New Death: Dynamic Classes
                        if(event_type == "new_case" || event_type == "new_death"){
                            var yesterday = index - 1;
                            var bins = Dictionary(${_class})[index]
                            if(yesterday < 0){
                                return 0;
                            }else{
                                if(event_type == "new_case"){
                                    var case_ts = Split($feature['cases_ts'],',');
                                    val = Number(case_ts[index]) - Number(case_ts[yesterday]);
                                }
                                if(event_type == "new_death"){
                                    var death_ts = Split($feature['deaths_ts'],',');
                                    val = Number(death_ts[index]) - Number(death_ts[yesterday]);
                                }
                            }

                        }
                        // Other 5 situations: Constant Classes
                        else{
                            var bins = [${_class}];
                            if(event_type == "case" || event_type == "case_per_100k_capita"){
                                var case_ts = Split($feature['cases_ts'],',');
                                val = case_ts[index];
                                if(event_type == "case_per_100k_capita"){
                                    val = val/population;
                                }
                            }
                            else if(event_type == "death" || event_type == "death_per_100k_capita"){
                                var death_ts = Split($feature['deaths_ts'],',');
                                val = death_ts[index];
                                if(event_type == "death_per_100k_capita"){
                                    val = val/population;
                                }
                            }
                            else if(event_type == "death_case_ratio"){
                                var case_ts = Split($feature['cases_ts'],',');
                                var death_ts = Split($feature['deaths_ts'],',');
                                val = death_ts[index]/case_ts[index];
                            }
                            
                        }
                        // Find Class from bins
                        if(Count(bins) == 1){
                            return -1;
                        }
                        for(var x = 0; x < Count(bins); x ++){
                            if(val <= 0){
                                class = -1;
                                break;
                            }
                            if(val <= Number(bins[x])){
                                class = x;
                                break;
                            }
                        }
                        return class;
                        

                    `;
                }

                function dynamicClassArcade(_date, _class, _event_type = "case") {

                    // Drew: return must be followed by the open ` on the same line, and a semi-colon ";" is required after the close `!!!
                    return `
                        //be sure to use .getDate() for Day value!  NOT .getDay()!!!!!!!

                        var dt_thumb = Date(${_date.getFullYear()}, ${_date.getMonth()}, ${_date.getDate()});
                        var event_type = Lower('${_event_type}');
                        var val = 0;
                        var class = 0;
                        var case_ts = null;
                        var death_ts = null;
                        var population = Number($feature['population'])/100000;
                        var bins = [${_class}];
                        var dt_start_array = Split($feature.dt_start, '-');
                        var dt_start = Date(Number(dt_start_array[0]), Number(dt_start_array[1])-1, Number(dt_start_array[2]));
                        if(dt_thumb < dt_start){
                            class = -1;
                            return class;
                        }
                        var days=DateDiff(dt_thumb, dt_start, "days");
                        var index = Ceil(days);

                        if(event_type == "case" || event_type == "case_per_100k_capita"){
                            case_ts = Split($feature['cases_ts'],',');
                            val = case_ts[index];
                            if(event_type == "case_per_100k_capita"){
                                val = val/population;
                            }
                        }
                        else if(event_type == "death" || event_type == "death_per_100k_capita"){
                            death_ts = Split($feature['deaths_ts'],',');
                            val = death_ts[index];
                            if(event_type == "death_per_100k_capita"){
                                val = val/population;
                            }
                        }
                        else if(event_type == "death_case_ratio"){
                            case_ts = Split($feature['cases_ts'],',');
                            death_ts = Split($feature['deaths_ts'],',');
                            val = death_ts[index]/case_ts[index];
                        }
                        for(var x = 0; x < Count(bins); x ++){
                            if(val <= 0){
                                class = -1;
                                break;
                            }
                            if(val <= Number(bins[x])){
                                class = x;
                                break;
                            }
                        }
                        return class;

                    `;
                }

                function firstEventArcade(_date, _event_type = "Case") {
                    // Drew: return must be followed by the open ` on the same line, and a semi-colon ";" is required after the close `!!!
                    return `
          //be sure to use .getDate() for Day value!  NOT .getDay()!!!!!!!

          var dt_thumb = Date(${_date.getFullYear()}, ${_date.getMonth()}, ${_date.getDate()});
          var event_type = Lower('${_event_type}');
          var dt_first_event = null;
          var dt_null_string = '2099-01-01-';

           var field_name = "";
           if (event_type=="case")
           {field_name="dt_first_case";}
           else
           {field_name="dt_first_death";}
          var dt_first_event = DefaultValue($feature[field_name], dt_null_string);
          var dt_first_event_array = Split(dt_first_event, '-');
          var dt_first_event = Date(Number(dt_first_event_array[0]),
                                  Number(dt_first_event_array[1])-1,
                                  Number(dt_first_event_array[2]));

          var days=DateDiff(dt_thumb, dt_first_event, "days");
          return days;

          // // For UniqueValueRender or ClassBreakRender
          // if (days==0)
          // { return 0; }
          // else
          // {
          //   if (days>0)
          //       {return 1; }
          //   else
          //       {return -1;}
          // }

          `;
                }

                function firstEventRender2(_date, _event_type = "Case") {
                    var sym1 = {
                        type: "simple-fill", // autocasts as new SimpleFillSymbol()
                        color: "red",
                        outline: { // autocasts as new SimpleLineSymbol()
                            color: [128, 128, 128, 0.5],
                            width: "0.5px"
                        }
                    };
                    var sym0 = {
                        type: "simple-fill", // autocasts as new SimpleFillSymbol()
                        color: "#0ff",
                        outline: { // autocasts as new SimpleLineSymbol()
                            color: [128, 128, 128, 0.5],
                            width: "0.5px"
                        }
                    };
                    var sym_1 = {
                        type: "simple-fill", // autocasts as new SimpleFillSymbol()
                        color: "rgb(0, 0, 0)",
                        outline: { // autocasts as new SimpleLineSymbol()
                            color: [128, 128, 128, 0.5],
                            width: "0.5px"
                        }
                    };


                    // return {
                    //   type: "unique-value",
                    //     //defaultSymbol: { type: "simple-fill",color: "yellow" },
                    //     valueExpression: firstEventArcade(_date, _event_type=_event_type),
                    //       //valueExpression: "return 0",
                    // valueExpressionTitle:
                    //   "First Event: " + _event_type,
                    //     uniqueValueInfos: [
                    //               {
                    //           value: 1,
                    //           symbol: sym1,
                    //           label: _event_type+"(s) Reported",
                    //         },
                    //         {
                    //           value: 0,
                    //           symbol: sym0,
                    //           label: "First " + _event_type,
                    //         },
                    //           {
                    //           value: -1,
                    //           symbol: sym_1,
                    //           label: "No " + _event_type,
                    //         },
                    //       ],
                    // };
                    return {
                        type: "class-breaks", // autocasts as new ClassBreaksRenderer()

                        valueExpression: firstEventArcade(_date, _event_type = _event_type),
                        classBreakInfos: [{
                            minValue: 0,
                            maxValue: 0,
                            symbol: sym0,
                            label: "First Case" // label for symbol in legend
                        }, {
                            minValue: 1,
                            maxValue: 1,
                            symbol: sym1,
                            label: "Case(s) Reported" // label for symbol in legend
                        }, {
                            minValue: -1,
                            maxValue: -1,
                            symbol: sym_1,
                            label: "No Case" // label for symbol in legend
                        },]
                    };
                }

                function illinoisZipCodeRender(field_name, min, max) {
                    const defaultSym = {
                        type: "simple-fill", // autocasts as new SimpleFillSymbol()
                        outline: {
                            // autocasts as new SimpleLineSymbol()
                            color: [128, 128, 128, 0.8],
                            width: "0.5px"
                        }
                    };
                    const renderer = {
                        type: "simple", // autocasts as new SimpleRenderer()
                        symbol: defaultSym,
                        //label: "1-Week Ahead Forecast",
                        visualVariables: [{
                            type: "color",
                            field: field_name, //"ZipCodeForecast",
                            //normalizationField: "TOTPOP_CY",
                            legendOptions: {
                                title: "Number of Cases"
                            },
                            stops: [{
                                value: max,
                                color: "#FF0000",
                                label: max.toString()
                            }, {
                                value: min,
                                color: "#000000",
                                label: min.toString()
                            }]
                        }]
                    };
                    return renderer;

                }


                /**
                 * Starts the animation that cycle
                 * through the construction years.
                 */
                function startAnimation() {
                    stopAnimation();
                    animation = animate(slider.values[0]);
                    playButton.classList.add("toggled");
                }

                /**
                 * Stops the animations
                 */
                function stopAnimation() {
                    if (!animation) {
                        return;
                    }

                    animation.remove();
                    animation = null;
                    playButton.classList.remove("toggled");
                }

                /**
                 * Animates the color visual variable continously
                 */
                function animate(startValue) {
                    var animating = true;
                    var value = startValue;

                    var frame = function (timestamp) {
                        if (!animating) {
                            return;
                        }

                        value += 1;
                        if (value > slider.max) {
                            value = slider.max;
                        }
                        var dt_thumb = date.add(dt_start, dt_interval_unit, Math.floor(value));
                        setDate(dt_thumb, animation_type = animation_type);

                        // Update at 30fps
                        setTimeout(function () {
                            requestAnimationFrame(frame);
                        }, 1000 / 10);
                    };

                    frame();

                    return {
                        remove: function () {
                            animating = false;
                        }
                    };
                }

            }; //main


            function pre_main() {
                // let counties_data_json_url = "/nyt_counties_data.json";
                // let states_data_json_url = "/nyt_states_data.json";
                let counties_data_json_url = "";
                let states_data_json_url = "";
                let classes_json_url = "preprocessing/classes.json";
                let dynamic_classes_json_url = "preprocessing/dynamic_classes.json";

                // if (production_mode) {
                //     // proxy to CORS
                //     let proxy_url = "https://cors-anywhere.herokuapp.com/";
                //     counties_data_json_url = proxy_url + "https://raw.githubusercontent.com/cybergis/cybergis.github.io/master/nyt_counties_data.json";
                //     states_data_json_url = proxy_url + "https://raw.githubusercontent.com/cybergis/cybergis.github.io/master/nyt_states_data.json";
                // }

                let counties_request = request(counties_data_json_url, {handleAs: "json"});
                let states_request = request(states_data_json_url, {handleAs: "json"});
                let classes_request = request(classes_json_url, {handleAs: "json"});
                let dynamic_classes_request = request(dynamic_classes_json_url, {handleAs: "json"});

                let dl = new DeferredList([counties_request, states_request, classes_request, dynamic_classes_request]);
                return dl.then(setGlobal_JSON);
            }

            function setGlobal_JSON(res) {
                counties_data = res[0][1];
                //counties_data_str = JSON.stringify(counties_data);
                states_data = res[1][1];
                //states_data_str = JSON.stringify(states_data);
                classes_data = res[2][1];
                dynamic_classes_data = res[3][1];

                let promise = new Promise(function (resolve, reject) {
                    // the function is executed automatically when the promise is constructed

                    // after 1 millisecond signal that the job is done with the result "done"
                    setTimeout(() => resolve("Load JSON Done"), 1);
                });
                return promise;
            }

            //pre_main().then(main);
            pre_main().then(main);

        });
    </script>
</head>

<body>
<div class="loading-overlay"></div>
<div class="loading-overlay-image-container">
    <div class="loader"></div>
</div>

<nav class="container-fluid py-1 d-flex justify-content-center">
    <div class="col-12 col-lg-10 d-flex flex-column flex-md-row justify-content-between">
        <div class="topic-brand d-flex">
            <a href="https://cybergisxhub.cigi.illinois.edu/wherecovid-19">
                <img class="topic-logo" style="font-weight: 300; width: 35px;"
                     src="data:image/jpeg;base64,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"></a>
            <a href="https://cybergisxhub.cigi.illinois.edu/wherecovid-19"
               style="text-decoration:none; color:black; padding-left: 10px;">
                <h3 class="topic-name" style="position:relative;font-weight: bold;margin: 0;">WhereCOVID-19
                    <span style="font-size: 14px;">by CyberGIS Center for Advanced Digital and Spatial Studies at the University of Illinois at Urbana-Champaign</span>
                </h3>
            </a>
        </div>
        <div class="nav-link" style="padding: 0;">
            <a href="https://cybergisxhub.cigi.illinois.edu" class="btn btn-light" style="font-weight:bold">Go to
                CyberGISX</a>
        </div>
    </div>
</nav>

<div id="applicationDiv">

    <!--
        <div class="sidebar-left">

            <div class="bordered-box total d-flex flex-column p-1" id="total_confirm_div">

                <h2 class="text-center">Total Confirmed</h2>
                <h3 class="text-center confirmed"></h3>
            </div>

            <div class="bordered-box total d-flex flex-column p-1" id="total_death_div">

                <h2 class="text-center">Total Deaths</h2>
                <h3 class="text-center deaths"></h3>
            </div>
            <recover div>
            <div class="bordered-box total d-flex flex-column p-1" id="total_recover_div">
                <i class="far fa-times-circle"></i>
                <h2 class="text-center">Total Recovered</h2>
                <h3 class="text-center recovered"></h3>
            </div>
            <div class="bordered-box cases d-flex flex-column">

                <div class="title p-3">
                    <p class="text-center">Top Confirmed Cases by County</p>
                </div>
                <ul class="case-list">
                    <template>
                        <li class="case text-center">
                            <p>
                                    <span style="color:#e60000">
                                            <strong>65,883</strong>
                                        </span>
                                <span style="color:#ffffff">&nbsp;</span>
                                <span style="color:#d6d6d6">United Kingdom</span>
                            </p>
                        </li>
                    </template>
                </ul>
            </div>
        </div>
    -->
    
    <div id="sliderContainer" class="esri-widget">
        <!-- <div id = "parametersDiv">
            <div id = "logDiv">
                <div class="form-check form-check-inline 1">
                    <input type="radio" name="logOptions" id="nologRadio" value="nolog" checked>
                    <label class="form-check-label" for="nologRadio">Origin Value</label>
                </div>
                <div class="form-check form-check-inline 1">
                    <input class="form-check-input 1" type="radio" name="logOptions" id="logRadio" value="log">
                    <label class="form-check-label" for="logRadio">Log Value</label>
                </div>
            </div>
            <div id = "renderDiv">
                <div class="form-check form-check-inline 2">
                    <input class="form-check-input" type="radio" name="renderOptions" id="QuantilesRatio" value="Quantiles" checked>
                    <label class="form-check-label" for="QuantilesRatio">Quantiles</label>
                </div>
                <div class="form-check form-check-inline 2">
                    <input class="form-check-input" type="radio" name="renderOptions" id="NaturalBreaksRatio" value="NaturalBreaks">
                    <label class="form-check-label" for="NaturalBreaksRatio">Natural Breaks</label>
                </div>
                <div class="form-check form-check-inline 2">
                    <input class="form-check-input" type="radio" name="renderOptions" id="FisherJenksRatio" value="FisherJenks">
                    <label class="form-check-label" for="FisherJenksRatio">Fisher Jenks</label>
                </div>
            </div>
            <div id = "dataDiv">
                <div class="form-check form-check-inline 3">
                    <input class="form-check-input" type="radio" name="dataOptions" id="CaseRatio" value="case" checked>
                    <label class="form-check-label" for="CaseRatio">Case</label>
                </div>
                <div class="form-check form-check-inline 3">
                    <input class="form-check-input" type="radio" name="dataOptions" id="DeathRatio" value="death">
                    <label class="form-check-label" for="DeathRatio">Death</label>
                </div>
                <div class="form-check form-check-inline 3">
                    <input class="form-check-input" type="radio" name="dataOptions" id="Case_per_100k_capitaRatio" value="case_per_100k_capit">
                    <label class="form-check-label" for="Case_per_100k_capitaRatio">Case per 100k capita</label>
                </div>
                <div class="form-check form-check-inline 3">
                    <input class="form-check-input" type="radio" name="dataOptions" id="Death_per_100k_capitaRatio" value="death_per_100k_capita">
                    <label class="form-check-label" for="Death_per_100k_capitaRatio">Death per 100k capita</label>
                </div>
            </div>
        </div> -->
        <div id="playButton" class="esri-widget esri-widget--button toggle-button">
            <div>
                <span class="toggle-button-icon esri-icon-play" aria-label="play icon"></span> Time
            </div>
            <div>
                <span class="toggle-button-icon esri-icon-pause" aria-label="pause icon"></span> Pause
            </div>
        </div>
        <div id="sliderInnerContainer">
            <div id="slider"></div>
        </div>
        <span id="sliderValue"></span>
        
    </div>

    <div id="viewDiv">
    </div>

    <div class="chart-wrap">
        <canvas id="myChart"></canvas>
    </div>
    <div>
        <select name="select" id="animation_dropdown" style="display: none">
            <option value="case">Cases</option>
            <option value="death">Deaths</option>
            <option value="death/case">Deaths/Cases</option>
            <option value="new_case">New Cases</option>
            <option value="new_death">New Deaths</option>
            <option value="first_case" selected="selected">First Case Report</option>
            <option value="first_death">First Death Report</option>
        </select>
    </div>

</div>

</body>

</html>